{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Documents/IT.Projects/Test%20scraper/ss-search-test/pages/api/search.js"],"sourcesContent":["import * as cheerio from \"cheerio\";\n\nfunction guessSearchUrl(q) {\n  // IMPORTANT:\n  // Replace this with the real ss.com search results URL pattern.\n  // How to get it:\n  // 1) Go to ss.com, search for something manually\n  // 2) Copy the results page URL\n  // 3) Paste it here and replace the query part with ${encodeURIComponent(q)}\n  //\n  // Example placeholder (WILL NOT WORK until you replace it):\n  return `https://www.ss.com/en/search-result/?q=${encodeURIComponent(q)}`;\n}\n\nexport default async function handler(req, res) {\n  try {\n    const q = (req.query.q || \"\").toString().trim();\n    if (!q) return res.status(400).json({ error: \"Missing q\" });\n\n    const url = guessSearchUrl(q);\n\n    const r = await fetch(url, {\n      headers: {\n        // Pretend to be a normal browser (often helps)\n        \"User-Agent\":\n          \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/123 Safari/537.36\",\n        \"Accept-Language\": \"en-US,en;q=0.9\",\n      },\n    });\n\n    if (!r.ok) {\n      return res.status(502).json({ error: `Upstream HTTP ${r.status} fetching ${url}` });\n    }\n\n    const html = await r.text();\n    const $ = cheerio.load(html);\n\n    // IMPORTANT:\n    // You must set selectors that match ss.com’s search results HTML.\n    // We start with a very generic approach:\n    // - pick links that look like listing links\n    // - extract title text + nearby price if possible\n    //\n    // If this returns 0 items, we’ll adjust selectors based on the page HTML.\n    const items = [];\n\n    $(\"a\").each((_, a) => {\n      const href = $(a).attr(\"href\");\n      const title = $(a).text().trim().replace(/\\s+/g, \" \");\n      if (!href || !title) return;\n\n      // Basic filter: keep only “detail-like” links, skip navigation\n      // You will likely need to refine this after first run.\n      if (href.includes(\"msg\") || href.includes(\"item\") || href.match(/\\/\\w+\\/\\d+\\.html/)) {\n        const link = href.startsWith(\"http\") ? href : new URL(href, url).toString();\n\n        items.push({\n          title,\n          price: \"\", // we’ll fill later once we know where it lives in HTML\n          link,\n          source: \"ss.com\",\n        });\n      }\n    });\n\n    // Deduplicate by link\n    const seen = new Set();\n    const deduped = items.filter((it) => {\n      if (!it.link || seen.has(it.link)) return false;\n      seen.add(it.link);\n      return true;\n    });\n\n    res.status(200).json({\n      url_used: url,\n      count: deduped.length,\n      items: deduped.slice(0, 30),\n    });\n  } catch (e) {\n    res.status(500).json({ error: e?.message || String(e) });\n  }\n}"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,SAAS,eAAe,CAAC;IACvB,aAAa;IACb,gEAAgE;IAChE,iBAAiB;IACjB,iDAAiD;IACjD,+BAA+B;IAC/B,4EAA4E;IAC5E,EAAE;IACF,4DAA4D;IAC5D,OAAO,CAAC,uCAAuC,EAAE,mBAAmB,IAAI;AAC1E;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI;QACF,MAAM,IAAI,CAAC,IAAI,KAAK,CAAC,CAAC,IAAI,EAAE,EAAE,QAAQ,GAAG,IAAI;QAC7C,IAAI,CAAC,GAAG,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAY;QAEzD,MAAM,MAAM,eAAe;QAE3B,MAAM,IAAI,MAAM,MAAM,KAAK;YACzB,SAAS;gBACP,+CAA+C;gBAC/C,cACE;gBACF,mBAAmB;YACrB;QACF;QAEA,IAAI,CAAC,EAAE,EAAE,EAAE;YACT,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO,CAAC,cAAc,EAAE,EAAE,MAAM,CAAC,UAAU,EAAE,KAAK;YAAC;QACnF;QAEA,MAAM,OAAO,MAAM,EAAE,IAAI;QACzB,MAAM,IAAI,oKAAY,CAAC;QAEvB,aAAa;QACb,kEAAkE;QAClE,yCAAyC;QACzC,4CAA4C;QAC5C,kDAAkD;QAClD,EAAE;QACF,0EAA0E;QAC1E,MAAM,QAAQ,EAAE;QAEhB,EAAE,KAAK,IAAI,CAAC,CAAC,GAAG;YACd,MAAM,OAAO,EAAE,GAAG,IAAI,CAAC;YACvB,MAAM,QAAQ,EAAE,GAAG,IAAI,GAAG,IAAI,GAAG,OAAO,CAAC,QAAQ;YACjD,IAAI,CAAC,QAAQ,CAAC,OAAO;YAErB,+DAA+D;YAC/D,uDAAuD;YACvD,IAAI,KAAK,QAAQ,CAAC,UAAU,KAAK,QAAQ,CAAC,WAAW,KAAK,KAAK,CAAC,qBAAqB;gBACnF,MAAM,OAAO,KAAK,UAAU,CAAC,UAAU,OAAO,IAAI,IAAI,MAAM,KAAK,QAAQ;gBAEzE,MAAM,IAAI,CAAC;oBACT;oBACA,OAAO;oBACP;oBACA,QAAQ;gBACV;YACF;QACF;QAEA,sBAAsB;QACtB,MAAM,OAAO,IAAI;QACjB,MAAM,UAAU,MAAM,MAAM,CAAC,CAAC;YAC5B,IAAI,CAAC,GAAG,IAAI,IAAI,KAAK,GAAG,CAAC,GAAG,IAAI,GAAG,OAAO;YAC1C,KAAK,GAAG,CAAC,GAAG,IAAI;YAChB,OAAO;QACT;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB,UAAU;YACV,OAAO,QAAQ,MAAM;YACrB,OAAO,QAAQ,KAAK,CAAC,GAAG;QAC1B;IACF,EAAE,OAAO,GAAG;QACV,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO,GAAG,WAAW,OAAO;QAAG;IACxD;AACF"}}]
}